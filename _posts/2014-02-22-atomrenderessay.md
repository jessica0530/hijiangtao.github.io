---
date: 2014-02-22
layout: post
title: 基于并行计算的嵌入式数字影像集群渲染系统构想
thread: 48
categories: 文档
tags: 集群 并行计算
---

论文写于2012年10月，当时团队准备以此系统构想进行挑战杯比赛申报，但期间由于某些原因，项目申报流产。最近翻到当时自己写的这篇系统报告，感觉有点意思，于是就发到Data.Blog上来了。如果你有任何想法或是意见，欢迎留言交流、一起探讨！

----

##一、摘要

本文章论述了基于并行计算的嵌入式数字影像集群渲染系统的构成、特点及工作流程，阐述了当前主要的几种集群渲染技术的概况、缺点与不足，同时并分析了我们准备研发的集群渲染系统的优势与未来市场前景，并结合国内外数字影像集群渲染系统的发展情况进行了综合阐述。

**关键词：集群，并行计算，云计算，ATOM，LINUX，渲染，三维动画，RENDER**

----

##二、开发集群渲染系统的背景

在动画制作过程中，对复杂的场景和特效进行渲染，是一个非常耗时的过程。渲染所需时间过长，直接影响到了整个动画制作的效率和周期，成为了动画制作过程中的瓶颈。因此动画制作领域需要迫切解决的一个问题就是如何利用现有资源，提高动画制作的效率。

**集群渲染系统**主要解决了动画渲染时间过长、资源管理复杂等关键问题，提高了软硬件资源的利用率，在国内外的三维动画和影视制作中，使用集群渲染系统来提高渲染效率的人越来越多。集群渲染平台是利用集群计算机的优势，通过网络分发软件和并行3D 渲染软件， 充分利用集群网络中的计算机硬件资源，将复杂的3D 场景通过大量的计算，生成预览图像或最终动画图像，以供效果调整审定或后期制作合成之用。集群渲染系统能够对整个网络上的资源进行合理的分配和优化，对提交给系统的作业进行管理，实施高效快速的大规模渲染。

**国外应用情况**

在好莱坞， 集群渲染系统已经在很多商业影片中得到应用。工业光魔公司在2002 年组建了强大的集群渲染系统Death Star（死星），为《星战前传三部曲》提供渲染服务。该系统拥有750 个渲染节点，共1500 颗AMD Athlon 1600 CPU，每个节点配备2G 内存。在2004 年，惠普公司为迪斯尼构建了一套集群渲染系统。该系统采用900 颗Intel Xeon 3.06GHz 处理器，使用HPC 集群技术， 并整合Platform LSF 以及EnFuzion 管理软件，其计算能力在当时的电影制作公司中位居第一，在2004年世界500 强超级计算机名列第57 位。

**国内应用情况**

数字媒体内容创作产业的迅速发展，使得国内动画产业基地如雨后春笋般迅速建立起来。近两年集群渲染系统发展更是异常迅猛。

中央电视台使用了一套由100 台HP 主机组成的并行集群渲染系统，它使用Turbo Linux 操作系统，采用Platform LSF5 和EnFuzion 集群管理软件进行任务的管理和调度。

湖南国家数字媒体技术产业化基地三维集群渲染系统拥有100 个CPU，采用Deadline 渲染管理软件和mental ray 渲染软件，支持3ds Max、Maya 等制作软件。

上海市多媒体公共服务平台选用了Softimage/XSI4.0、3dsMax、Maya 等三维制作软件和RenderMan、mental ray 等著名渲染软件，集群渲染系统采用Muster 分发软件，可对任何三维动画项目实施制作和渲染。同时也使用了清华同方的基于GPU 的集群渲染系统。

广州影视动画渲染中心使用HP、SUN、IBM HS 刀片系列服务器组建约1000CPU 核心的集群渲染系统。该系统使用Deadline3.0 和Muster5.5.4 等作为管理软件， 支持Renderman、Mental-Ray、Vray 等渲染， 可对目前主流三维动画软件Maya、3ds max、C4D 等制作的多媒体作品进行集群渲染。支持2K 至8K 的序列帧渲染，2K 至16K 或以上的高分辩率图像渲染。

CG 渲染农场公共平台（上海）：上海CG 渲染农场目前建成2860 颗高端服务器CPU 节点，所有设备均可以制作从标清到4K 不同分辨率的动画。平台设备均实现了高智能高集群化的全自动管理，并保证数据的私密性和安全性。

国外技术发达，有关集群渲染技术的开发已经达到了一个不错的高度，而国内该技术才刚起步，掌握得较好的公司不大于三家，因此我们研发的这套系统若是成功则会具有很高的市场前景与实用价值。

----

##三、名词解释

###有关并行计算的现实概况

当前，高性能计算被广泛应用于高科技研究和诸多工业领域，以高性能计算为基础的计算科学得到了显著的发展。同时，需求的不断增加和对性能的苛刻要求给新一代的高性能计算系统的研究与设计带来了严峻的挑战。特别是随着处理器性能和系统规模的迅速提升，急剧增长的功耗严重限制了高性能计算系统的设计和使用。为有效管理系统功耗，提高系统的可靠性和可用性，最终降低高性能计算系统的拥有代价，低功耗技术已成为高性能计算领域的关键技术。上世纪90年代以来，大规模并行处理系统（massively parallel processing，MPP）和集群（Cluster）系统已成为高性能计算机主要的体系结构。在并行计算系统中，并行资源管理软件根据调度算法从作业队列中选择合适的作业，并为其分配和释放计算结点。

传统的作业调度和资源管理主要关注两点：降低作业的平均等待时间和提高整个系统的利用率。然而，由于没有足够的作业负载，以及作业调度和资源分配策略无法充分利用系统资源，常常会有空闲资源浪费系统能耗的情况。

针对以上问题，本课题分析了高性能并行计算系统负载与能耗的特点，并基于并行资源管理技术，设计了两类针对高性能并行计算系统的自适应功耗管理算法。两类功耗管理算法分别采用了限制资源分配和关闭空闲结点的方法。其中基于限制资源分配的算法根据系统利用率或作业平均slowdown的变化，自适应调整可用结点数目，并关闭非可用结点以节省系统能耗；关闭空闲结点的算法则根据结点的关闭间隔时间或请求和服务速率自适应调整结点的空闲时间阀值，并使空闲时间超出阀值的结点进入“睡眠”状态以节省系统能耗。实验使用来源于ParallelWorkloads Archive的负载对两类算法进行了测试，结果表明，两类算法均能在不违反性能限制的前提下，有效降低系统能耗。

###有关云计算的简单概述

通过使计算分布在大量的分布式计算机上，而非本地计算机或远程服务器中，企业数据中心的运行将与互联网更相似。这使得企业能够将资源切换到需要的应用上，根据需求访问计算机和存储系统。

利用云计算不仅能提高工作效率，同时能达到极大的节约资源的效果。我们把任务统一分配给远程计算机，然后本地计算机只需要承担传输数据的任务，这样既利用了服务器端高效的计算机群性能来处理数据，同时又有效减少了低级计算机慢速渲染带来的麻烦与损失。

###有关渲染服务器工作的简介

原理上是这样的：系统中的每个客户端，会将制作好的三维场景文件提交给集群渲染的服务器，由集群渲染服务器将任务发配给系统中任意一个节点，渲染完成后每个节点再将结果返回渲染服务器，最后由渲染服务器把视频信号输出到视频设备（如Beta Cam、DVD 制作设备和打印机）或者三维/视频工作站。

而言简意赅地说，这一过程就相当于将渲染工作划分成诸多小单元，分摊到多个CPU 去完成，之后将结果再组合起来。这种方式的关键点在于加快了系统进行渲染的速度。

----

##四、集群渲染系统的工作流程

本系统采用INTEL的ATOM开发板进行硬件开发，以嵌入式LINUX系统为软件开发平台，研发了一台低功耗，体积小，运行效率高，安全稳定的数字影像集群渲染服务器。用户可通过以太网方式对服务器进行图形化管理，远程发送渲染任务。集群渲染服务器收到渲染任务后，将根据当前集群中各个渲染节点的负载情况对任务进行分块，并通过交换机VLAN协议与同一局域网内的多台渲染节点连接，将各个块任务分发到渲染节点进行计算。

----

##五、系统优点与广阔前景

本系统可运用于各类影视制作基地、电影公司、三维动画制作、高清效果图制作、影像后期制作等领域。支持常见的3D MAX、MAYA、AFTER EFFECT等数字影像制作软件，具有极高的技术性及实用性。

----

参考：

[1] 戴敏利，陆峰，王敏 集群渲染系统及其应用现状研究 2009(04)

[2] 董晶 高性能并行计算系统中低功耗资源管理的设计与研究 2011(S1)

[3] 边锋，郑悦 动漫不“慢”——服务器集群对“渲染”的积极作用 TP391.41
